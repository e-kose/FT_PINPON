input {
  tcp {
    port => 5044
    codec => json_lines
  }
}

filter {
  if [service] == "api-gateway" {
    mutate { add_field => { "[@metadata][index]" => "api-gateway-logs-%{+YYYY.MM.dd}" } }
  } else if [service] == "auth-service" {
    mutate { add_field => { "[@metadata][index]" => "auth-service-logs-%{+YYYY.MM.dd}" } }
  } else if [service] == "user-service" {
    mutate { add_field => { "[@metadata][index]" => "user-service-logs-%{+YYYY.MM.dd}" } }
  } else if [service] == "chat-service" {
    mutate { add_field => { "[@metadata][index]" => "chat-service-logs-%{+YYYY.MM.dd}" } }
  } else {
    mutate { add_field => { "[@metadata][index]" => "application-logs-%{+YYYY.MM.dd}" } }
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "%{[@metadata][index]}"
    user => "${LOGSTASH_WRITER_USER}"
    password => "${LOGSTASH_WRITER_PASSWORD}"
    retry_initial_interval => 1
    retry_max_interval => 60
  }
  stdout { codec => rubydebug }
}